<div class="d-flex align-items-center justify-content-between mb-4">
  <div>
    <h4 class="fw-bold mb-1">Finances</h4>
    <p class="text-muted mb-0">Vue d'ensemble financière</p>
  </div>
  <button class="btn btn-outline-primary" (click)="exportReport()"><i class="bi bi-download me-2"></i>Export comptable</button>
</div>

<!-- KPI Cards -->
<div class="row g-3 mb-4">
  <div class="col-xl-3 col-md-6">
    <app-stat-card label="Revenu total" [value]="data().totalRevenue" icon="bi-currency-dollar" bgColor="#ecfdf5" iconColor="#10b981" [isCurrency]="true" />
  </div>
  <div class="col-xl-3 col-md-6">
    <app-stat-card label="Commissions" [value]="data().totalCommissions" icon="bi-percent" bgColor="#eef2ff" iconColor="#4f46e5" [isCurrency]="true" />
  </div>
  <div class="col-xl-3 col-md-6">
    <app-stat-card label="Paiements effectués" [value]="totalPayouts()" icon="bi-send" bgColor="#fef3c7" iconColor="#f59e0b" [isCurrency]="true" />
  </div>
  <div class="col-xl-3 col-md-6">
    <app-stat-card label="Remboursements" [value]="data().totalRefunds" icon="bi-arrow-counterclockwise" bgColor="#fce7f3" iconColor="#ec4899" [isCurrency]="true" />
  </div>
</div>

<!-- Charts -->
<div class="row g-3 mb-4">
  <div class="col-lg-8">
    <div class="table-card">
      <div class="card-header"><h6 class="fw-bold mb-0">Revenus mensuels</h6></div>
      <div class="p-3"><canvas #revenueChart height="300"></canvas></div>
    </div>
  </div>
  <div class="col-lg-4">
    <div class="table-card">
      <div class="card-header"><h6 class="fw-bold mb-0">Répartition paiements</h6></div>
      <div class="p-3"><canvas #moduleChart height="300"></canvas></div>
    </div>
  </div>
</div>

<!-- Transactions -->
<div class="table-card">
  <div class="card-header"><h6 class="fw-bold mb-0">Transactions récentes</h6></div>
  <div class="table-responsive">
    <table class="table table-hover mb-0">
      <thead>
        <tr><th>Référence</th><th>Type</th><th>Description</th><th>Montant</th><th>Statut</th><th>Date</th></tr>
      </thead>
      <tbody>
        @for (t of transactions(); track t.id) {
          <tr>
            <td class="fw-medium text-primary">{{ t.reference }}</td>
            <td><span class="badge bg-light text-dark">{{ t.type }}</span></td>
            <td>{{ t.description }}</td>
            <td class="fw-bold" [class.text-success]="t.amount > 0" [class.text-danger]="t.amount < 0">
              {{ t.amount > 0 ? '+' : '' }}{{ t.amount | number:'1.2-2' }} MAD
            </td>
            <td>
              @let s = (t.status | statusBadge);
              <span class="badge-status" [class]="'bg-' + s.color + '-subtle text-' + s.color">{{ s.label }}</span>
            </td>
            <td class="text-muted">{{ t.date | date:'dd/MM/yyyy HH:mm' }}</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
