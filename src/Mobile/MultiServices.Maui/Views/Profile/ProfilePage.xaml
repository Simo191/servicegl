<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MultiServices.Maui.ViewModels.Profile"
             x:Class="MultiServices.Maui.Views.Profile.ProfilePage"
             x:DataType="vm:ProfileViewModel"
             Title="Profil">
    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="16">
            <!-- Profile Header -->
            <Frame Style="{StaticResource CardFrame}">
                <HorizontalStackLayout Spacing="16">
                    <Frame BackgroundColor="{StaticResource PrimaryLight}" CornerRadius="35" HeightRequest="70" WidthRequest="70" HasShadow="False" Padding="0">
                        <Label Text="{Binding User.FirstName, StringFormat='{0:0}'}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource Primary}"
                               HorizontalOptions="Center" VerticalOptions="Center" />
                    </Frame>
                    <VerticalStackLayout VerticalOptions="Center" Spacing="4">
                        <Label Text="{Binding User.FullName}" Style="{StaticResource Title2}" />
                        <Label Text="{Binding User.Email}" FontSize="13" TextColor="{StaticResource TextMuted}" />
                        <HorizontalStackLayout Spacing="4">
                            <Frame BackgroundColor="#FEF3C7" CornerRadius="8" Padding="8,2" HasShadow="False">
                                <Label Text="{Binding User.LoyaltyTier}" FontSize="11" FontAttributes="Bold" TextColor="#92400E" />
                            </Frame>
                            <Label Text="{Binding User.LoyaltyPoints, StringFormat='{0} pts'}" FontSize="12" TextColor="{StaticResource TextMuted}" VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </HorizontalStackLayout>
            </Frame>

            <!-- Wallet -->
            <Frame BackgroundColor="{StaticResource Primary}" CornerRadius="16" Padding="20" HasShadow="True">
                <Grid ColumnDefinitions="*,Auto">
                    <VerticalStackLayout Spacing="4">
                        <Label Text="Mon portefeuille" TextColor="White" FontSize="13" Opacity="0.8" />
                        <Label Text="{Binding Wallet.Balance, StringFormat='{0:N2} DH'}" TextColor="White" FontSize="28" FontAttributes="Bold" />
                    </VerticalStackLayout>
                    <Button Grid.Column="1" Text="+ Recharger" BackgroundColor="White" TextColor="{StaticResource Primary}"
                            CornerRadius="12" FontSize="13" FontAttributes="Bold" HeightRequest="40" VerticalOptions="Center"
                            Command="{Binding ViewWalletCommand}" />
                </Grid>
            </Frame>

            <!-- Menu Items -->
            <Frame Style="{StaticResource CardFrame}" Padding="0">
                <VerticalStackLayout>
                    <!-- Edit Profile -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="ðŸ‘¤" FontSize="20" />
                        <Label Grid.Column="1" Text="Modifier le profil" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding EditProfileCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Border}" Margin="16,0" />
                    <!-- Addresses -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="ðŸ“" FontSize="20" />
                        <Label Grid.Column="1" Text="Mes adresses" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding ManageAddressesCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Border}" Margin="16,0" />
                    <!-- Orders -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="ðŸ“¦" FontSize="20" />
                        <Label Grid.Column="1" Text="Mes commandes" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:ProfileViewModel}}, Path=ViewFavoritesCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Border}" Margin="16,0" />
                    <!-- Favorites -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="â¤ï¸" FontSize="20" />
                        <Label Grid.Column="1" Text="Mes favoris" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding ViewFavoritesCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Border}" Margin="16,0" />
                    <!-- Loyalty -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="ðŸ†" FontSize="20" />
                        <Label Grid.Column="1" Text="Programme fidÃ©litÃ©" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding ViewLoyaltyCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                    <BoxView HeightRequest="1" BackgroundColor="{StaticResource Border}" Margin="16,0" />
                    <!-- Support -->
                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="16,14" ColumnSpacing="12">
                        <Label Text="ðŸ’¬" FontSize="20" />
                        <Label Grid.Column="1" Text="Support" FontSize="15" VerticalOptions="Center" />
                        <Label Grid.Column="2" Text="â€º" FontSize="20" TextColor="{StaticResource TextMuted}" />
                        <Grid.GestureRecognizers><TapGestureRecognizer Command="{Binding ContactSupportCommand}" /></Grid.GestureRecognizers>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Logout / Delete -->
            <Button Text="Se dÃ©connecter" Style="{StaticResource SecondaryButton}" Command="{Binding LogoutCommand}" />
            <Button Text="Supprimer mon compte" BackgroundColor="Transparent" TextColor="{StaticResource Danger}" 
                    FontSize="14" Command="{Binding DeleteAccountCommand}" Margin="0,0,0,20" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
