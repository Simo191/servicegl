<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MultiServices.Maui.ViewModels.Checkout"
             x:Class="MultiServices.Maui.Views.Checkout.CheckoutAuthPage"
             x:DataType="vm:CheckoutAuthViewModel" Title="Vos informations">
    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="24">
            <Label Text="Finalisez votre commande" FontSize="22" FontAttributes="Bold" />
            <Label Text="Pour passer commande, nous avons besoin de quelques informations" FontSize="14" TextColor="{StaticResource TextMuted}" />

            <!-- Step 1: Info -->
            <Frame Style="{StaticResource CardFrame}" IsVisible="{Binding IsStep1}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Vos coordonnées" FontAttributes="Bold" FontSize="16" />
                    <Entry Placeholder="Prénom *" Text="{Binding FirstName}" />
                    <Entry Placeholder="Nom *" Text="{Binding LastName}" />
                    <Entry Placeholder="Téléphone *" Text="{Binding Phone}" Keyboard="Telephone" />
                    <Entry Placeholder="Email *" Text="{Binding Email}" Keyboard="Email" />
                    <Button Text="Recevoir le code SMS" Command="{Binding SendOtpCommand}"
                            BackgroundColor="{StaticResource Primary}" TextColor="White" HeightRequest="50" CornerRadius="10" />
                </VerticalStackLayout>
            </Frame>

            <!-- Step 2: OTP -->
            <Frame Style="{StaticResource CardFrame}" IsVisible="{Binding IsStep2}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Vérification SMS" FontAttributes="Bold" FontSize="16" />
                    <Label Text="{Binding Phone, StringFormat='Code envoyé au {0}'}" FontSize="14" TextColor="{StaticResource TextMuted}" />
                    <Entry Placeholder="Code à 6 chiffres" Text="{Binding OtpCode}" Keyboard="Numeric" MaxLength="6" FontSize="24" HorizontalTextAlignment="Center" />
                    <Button Text="Vérifier et continuer" Command="{Binding VerifyOtpCommand}"
                            BackgroundColor="{StaticResource Primary}" TextColor="White" HeightRequest="50" CornerRadius="10" />
                    <Button Text="Renvoyer le code" Command="{Binding ResendOtpCommand}"
                            BackgroundColor="Transparent" TextColor="{StaticResource Primary}" IsVisible="{Binding CanResend}" />
                    <Label Text="{Binding ResendTimer, StringFormat='Renvoyer dans {0}s'}" IsVisible="{Binding IsTimerRunning}"
                           HorizontalOptions="Center" FontSize="13" TextColor="{StaticResource TextMuted}" />
                </VerticalStackLayout>
            </Frame>

            <Label Text="{Binding ErrorMessage}" TextColor="{StaticResource Danger}" IsVisible="{Binding HasError}" HorizontalOptions="Center" />
            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
