<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:vm="clr-namespace:MultiServices.Store.ViewModels"
       xmlns:models="clr-namespace:MultiServices.Store.Models"
       x:Class="MultiServices.Store.Views.Stats.StatsPage" x:DataType="vm:StatsViewModel" Title="{Binding Title}">
    <ScrollView><VerticalStackLayout Spacing="16" Padding="16">
        <HorizontalStackLayout Spacing="8" HorizontalOptions="Center">
            <Button Text="Jour" Command="{Binding SetPeriodCommand}" CommandParameter="day" BackgroundColor="{StaticResource Info}" TextColor="White" CornerRadius="20" HeightRequest="36" FontSize="13" />
            <Button Text="Semaine" Command="{Binding SetPeriodCommand}" CommandParameter="week" BackgroundColor="{StaticResource Info}" TextColor="White" CornerRadius="20" HeightRequest="36" FontSize="13" />
            <Button Text="Mois" Command="{Binding SetPeriodCommand}" CommandParameter="month" BackgroundColor="{StaticResource Primary}" TextColor="White" CornerRadius="20" HeightRequest="36" FontSize="13" />
        </HorizontalStackLayout>
        <Frame Style="{StaticResource Card}"><VerticalStackLayout HorizontalOptions="Center"><Label Text="Chiffre d'affaires" Style="{StaticResource H3}" HorizontalOptions="Center" />
            <Label Text="{Binding Revenue, StringFormat='{0:N0} MAD'}" FontSize="36" FontAttributes="Bold" TextColor="{StaticResource Success}" HorizontalOptions="Center" /></VerticalStackLayout></Frame>
        <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">
            <Frame Style="{StaticResource Card}" Padding="12"><VerticalStackLayout HorizontalOptions="Center"><Label Text="{Binding OrderCount}" FontSize="28" FontAttributes="Bold" HorizontalOptions="Center" /><Label Text="Commandes" FontSize="11" TextColor="{StaticResource TextMuted}" HorizontalOptions="Center" /></VerticalStackLayout></Frame>
            <Frame Grid.Column="1" Style="{StaticResource Card}" Padding="12"><VerticalStackLayout HorizontalOptions="Center"><Label Text="{Binding AvgBasket, StringFormat='{0:N0} MAD'}" FontSize="24" FontAttributes="Bold" HorizontalOptions="Center" /><Label Text="Panier moyen" FontSize="11" TextColor="{StaticResource TextMuted}" HorizontalOptions="Center" /></VerticalStackLayout></Frame>
            <Frame Grid.Column="2" Style="{StaticResource Card}" Padding="12"><VerticalStackLayout HorizontalOptions="Center"><Label Text="{Binding OutOfStock}" FontSize="28" FontAttributes="Bold" TextColor="{StaticResource Danger}" HorizontalOptions="Center" /><Label Text="Ruptures" FontSize="11" TextColor="{StaticResource TextMuted}" HorizontalOptions="Center" /></VerticalStackLayout></Frame>
        </Grid>
        <Frame Style="{StaticResource Card}"><VerticalStackLayout Spacing="8"><Label Text="Produits les plus vendus" Style="{StaticResource H3}" />
            <CollectionView ItemsSource="{Binding TopProducts}"><CollectionView.ItemTemplate><DataTemplate x:DataType="models:TopProductDto">
                <Grid ColumnDefinitions="*,Auto,Auto" Padding="0,6" ColumnSpacing="12"><Label Text="{Binding Name}" FontSize="14" /><Label Grid.Column="1" Text="{Binding SoldCount, StringFormat='{0}x'}" FontAttributes="Bold" /><Label Grid.Column="2" Text="{Binding Revenue, StringFormat='{0:N0} MAD'}" TextColor="{StaticResource Success}" /></Grid>
            </DataTemplate></CollectionView.ItemTemplate></CollectionView></VerticalStackLayout></Frame>
        <Button Text="ðŸ“Š Exporter le rapport" Command="{Binding ExportCommand}" BackgroundColor="White" TextColor="{StaticResource TextPrimary}" BorderColor="{StaticResource Border}" BorderWidth="1" CornerRadius="10" HeightRequest="44" />
    </VerticalStackLayout></ScrollView>
</ContentPage>