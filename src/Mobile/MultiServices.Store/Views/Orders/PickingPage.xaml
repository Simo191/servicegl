<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui" xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
       xmlns:vm="clr-namespace:MultiServices.Store.ViewModels"
       xmlns:models="clr-namespace:MultiServices.Store.Models"
       x:Class="MultiServices.Store.Views.Orders.PickingPage" x:DataType="vm:PickingViewModel" Title="{Binding Title}">
    <Grid RowDefinitions="Auto,*,Auto">
        <Frame Style="{StaticResource Card}" Margin="16,8"><VerticalStackLayout Spacing="4">
            <Label Text="{Binding Order.OrderNumber, StringFormat='Picking #{0}'}" Style="{StaticResource H3}" />
            <ProgressBar Progress="{Binding Progress}" ProgressColor="{StaticResource Success}" />
            <Label Text="{Binding PickedCount, StringFormat='{0}'}" FontSize="13"><Label.FormattedText><FormattedString>
                <Span Text="{Binding PickedCount}" FontAttributes="Bold" TextColor="{StaticResource Success}" /><Span Text=" / " /><Span Text="{Binding TotalCount}" FontAttributes="Bold" /><Span Text=" produits" />
            </FormattedString></Label.FormattedText></Label>
            <Button Text="ðŸ“· Scanner code-barre" Command="{Binding ScanBarcodeCommand}" BackgroundColor="{StaticResource Info}" TextColor="White" CornerRadius="8" HeightRequest="36" />
        </VerticalStackLayout></Frame>
        <CollectionView Grid.Row="1" ItemsSource="{Binding Items}" Margin="16,0"><CollectionView.ItemTemplate><DataTemplate x:DataType="models:GroceryOrderItemDto">
            <Frame Style="{StaticResource Card}" Margin="0,0,0,6" Padding="12"><Grid ColumnDefinitions="Auto,*,Auto,Auto" ColumnSpacing="8">
                <CheckBox IsChecked="{Binding IsPicked}" Color="{StaticResource Success}" />
                <VerticalStackLayout Grid.Column="1"><Label Text="{Binding ProductName}" FontSize="14" FontAttributes="Bold" /><Label Text="{Binding Quantity, StringFormat='QtÃ©: {0}'}" FontSize="12" /></VerticalStackLayout>
                <Button Grid.Column="2" Text="âœ“" BackgroundColor="{StaticResource Success}" TextColor="White" CornerRadius="8" HeightRequest="34" WidthRequest="40"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PickingViewModel}}, Path=PickItemCommand}" CommandParameter="{Binding .}" />
                <Button Grid.Column="3" Text="âœ—" BackgroundColor="{StaticResource Danger}" TextColor="White" CornerRadius="8" HeightRequest="34" WidthRequest="40"
                    Command="{Binding Source={RelativeSource AncestorType={x:Type vm:PickingViewModel}}, Path=MarkUnavailableCommand}" CommandParameter="{Binding .}" />
            </Grid></Frame></DataTemplate></CollectionView.ItemTemplate></CollectionView>
        <Button Grid.Row="2" Text="Terminer le picking" Command="{Binding FinishPickingCommand}" Style="{StaticResource PrimaryBtn}" Margin="16,8" />
    </Grid>
</ContentPage>